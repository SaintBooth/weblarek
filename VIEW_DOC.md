# Документация классов слоя Представления (View)

Классы, отвечающие за отображение данных в приложении "WebLarek"

## Базовые классы

### `Component<T>`

Абстрактный базовый класс для всех компонентов представления.

- **Назначение:** Предоставляет общую логику для рендеринга компонентов.
- **Поля:**
  - `container: HTMLElement`: Корневой DOM-элемент компонента.
- **Методы:**
  - `constructor(container: HTMLElement)`: Принимает DOM-элемент в качестве контейнера.
  - `toggleClass(element: HTMLElement, className: string, force?: boolean)`: Переключает класс на элементе.
  - `setText(element: HTMLElement, value: unknown)`: Устанавливает текстовое содержимое элемента.
  - `setDisabled(element: HTMLElement, state: boolean)`: Устанавливает атрибут `disabled` элемента.
  - `setHidden(element: HTMLElement)`: Скрывает элемент.
  - `setVisible(element: HTMLElement)`: Показывает элемент.
  - `setImage(element: HTMLImageElement, src: string, alt?: string)`: Устанавливает изображение и его альтернативный текст.
  - `render(data?: Partial<T>): HTMLElement`: Рендерит компонент с данными и возвращает корневой элемент.

## Классы страниц и модальных окон

### `Page`

Управляет основными элементами страницы.

- **Наследуется от:** `Component<IPage>`
- **Назначение:** Отображение каталога товаров и управление счетчиком корзины.
- **Поля:**
  - `_counter: HTMLElement`: Элемент счетчика товаров в корзине.
  - `_gallery: HTMLElement`: Контейнер для карточек товаров.
  - `_wrapper: HTMLElement`: Обертка страницы.
  - `_basket: HTMLElement`: Кнопка открытия корзины.
- **Свойства (setters):**
  - `counter`: Обновляет значение счетчика в корзине.
  - `gallery`: Заполняет галерею карточками товаров.
  - `locked`: Блокирует/разблокирует прокрутку страницы.
- **События:**
  - `basket:open`: Генерируется при клике на иконку корзины.

### `Modal`

Управляет модальным окном.

- **Наследуется от:** `Component<IModalData>`
- **Назначение:** Отображение контента в модальном окне, открытие и закрытие окна.
- **Поля:**
  - `_closeButton: HTMLButtonElement`: Кнопка закрытия модального окна.
  - `_content: HTMLElement`: Контейнер для содержимого модального окна.
- **Методы:**
  - `open()`: Открывает модальное окно.
  - `close()`: Закрывает модальное окно.
- **Свойства (setters):**
  - `content`: Устанавливает содержимое модального окна.
- **События:**
  - `modal:open`: Генерируется при открытии модального окна.
  - `modal:close`: Генерируется при закрытии модального окна (по кнопке или Escape).

## Классы карточек товаров

### `Card<T>` (абстрактный)

Базовый класс для всех видов карточек товаров.

- **Наследуется от:** `Component<T>`
- **Назначение:** Предоставляет общую логику для всех карточек.
- **Поля:**
  - `_title: HTMLElement`: Название товара.
  - `_price: HTMLElement`: Цена товара.
- **Свойства (getters/setters):**
  - `id`: ID товара.
  - `title`: Название товара.
  - `price`: Цена товара.

### `CatalogCard`

Карточка товара для отображения в каталоге на главной странице.

- **Наследуется от:** `Card<ICard>`
- **Назначение:** Отображение краткой информации о товаре в галерее.
- **Поля:**
  - `_category: HTMLElement`: Категория товара.
  - `_image: HTMLImageElement`: Изображение товара.
- **Свойства (setters):**
  - `category`: Категория товара.
  - `image`: Изображение товара.
- **События:**
  - `card:select`: Генерируется при клике на карточку.

### `PreviewCard`

Карточка для предпросмотра товара в модальном окне.

- **Наследуется от:** `CatalogCard`
- **Назначение:** Отображение полной информации о товаре.
- **Поля:**
  - `_description: HTMLElement`: Описание товара.
  - `_button: HTMLButtonElement`: Кнопка "В корзину".
- **Свойства (setters):**
  - `description`: Описание товара.
- **События:**
  - `card:add`: Генерируется при клике на кнопку "В корзину".

### `BasketCard`

Карточка товара в корзине.

- **Наследуется от:** `Card<ICard>`
- **Назначение:** Отображение товара в списке корзины.
- **Поля:**
  - `_index: HTMLElement`: Порядковый номер товара в корзине.
  - `_button: HTMLButtonElement`: Кнопка удаления товара из корзины.
- **Свойства (setters):**
  - `index`: Порядковый номер.
- **События:**
  - `card:remove`: Генерируется при клике на кнопку удаления.

## Классы корзины и заказа

### `Basket`

Компонент корзины.

- **Наследуется от:** `Component<IBasketView>`
- **Назначение:** Отображение списка товаров в корзине и общей стоимости.
- **Поля:**
  - `_list: HTMLElement`: Контейнер для списка товаров.
  - `_total: HTMLElement`: Элемент с общей стоимостью.
  - `_button: HTMLElement`: Кнопка "Оформить".
- **Свойства (setters):**
  - `items`: Рендерит список товаров в корзине.
  - `total`: Обновляет общую стоимость.
- **События:**
  - `order:start`: Генерируется при клике на кнопку "Оформить".

### `Success`

Компонент успешного оформления заказа.

- **Наследуется от:** `Component<ISuccess>`
- **Назначение:** Отображение сообщения об успешном заказе и списанной сумме.
- **Поля:**
  - `_close: HTMLElement`: Кнопка "За новыми покупками!".
  - `_total: HTMLElement`: Элемент списанной суммы.
- **Свойства (setters):**
  - `total`: Устанавливает списанную сумму.
- **События:**
  - `success:close`: Генерируется при клике на кнопку закрытия.

## Классы форм

### `Form<T>` (абстрактный)

Абстрактный базовый класс для форм.

- **Наследуется от:** `Component<IFormState>`
- **Назначение:** Предоставляет общую логику для управления формами (валидация, события).
- **Поля:**
  - `_submit: HTMLButtonElement`: Кнопка отправки формы.
  - `_errors: HTMLElement`: Контейнер для ошибок валидации.
- **Методы:**
  - `onInputChange(field: keyof T, value: string)`: Обработчик изменения значения в поле ввода.
- **Свойства (getters/setters):**
  - `valid`: Состояние валидности формы.
  - `errors`: Текст ошибок валидации.
- **События:**
  - `input:change`: Генерируется при изменении любого поля формы.
  - `form:submit`: Генерируется при отправке формы.

### `OrderForm`

Форма заказа (способ оплаты и адрес).

- **Наследуется от:** `Form<IOrderForm>`
- **Назначение:** Сбор данных о способе оплаты и адресе доставки.
- **Поля:**
  - `_cardButton: HTMLButtonElement`: Кнопка выбора оплаты онлайн.
  - `_cashButton: HTMLButtonElement`: Кнопка выбора оплаты при получении.
- **Методы:**
  - `setPaymentMethod(method: string)`: Устанавливает выбранный метод оплаты.

### `ContactsForm`

Форма контактных данных (email и телефон).

- **Наследуется от:** `Form<IOrderForm>`
- **Назначение:** Сбор контактных данных пользователя.

---

## События приложения

Этот раздел описывает все события, которые генерируются в приложении через брокер событий.

### События моделей данных

#### `catalog:changed`

- **Источник:** `Products` (модель данных)
- **Когда генерируется:** При установке каталога товаров через метод `setCatalog()`
- **Данные:** Отсутствуют
- **Описание:** Сигнализирует об обновлении каталога товаров, используется для перерисовки галереи на странице

#### `preview:changed`

- **Источник:** `Products` (модель данных)
- **Когда генерируется:** При установке товара для предпросмотра через метод `setPreview()`
- **Данные:** `IProduct` - данные выбранного товара
- **Описание:** Сигнализирует о выборе товара для предпросмотра, используется для открытия модального окна с детальной информацией

#### `basket:changed`

- **Источник:** `Basket` (модель данных)
- **Когда генерируется:** При любом изменении корзины: добавлении товара (`addItem()`), удалении товара (`removeItem()`), очистке корзины (`clear()`)
- **Данные:** Отсутствуют
- **Описание:** Сигнализирует об изменении состояния корзины, используется для обновления счетчика товаров, списка товаров в корзине и общей стоимости

#### `buyer:changed`

- **Источник:** `Buyer` (модель данных)
- **Когда генерируется:** При изменении данных покупателя через методы `setData()` или `clear()`
- **Данные:** Отсутствуют
- **Описание:** Сигнализирует об изменении данных покупателя (способ оплаты, адрес, email, телефон)

### События страницы

#### `basket:open`

- **Источник:** `Page`
- **Когда генерируется:** При клике на иконку корзины в шапке
- **Данные:** Отсутствуют
- **Описание:** Сигнализирует о необходимости открыть модальное окно с корзиной

### События модального окна

#### `modal:open`

- **Источник:** `Modal`
- **Когда генерируется:** При открытии модального окна
- **Данные:** Отсутствуют
- **Описание:** Сигнализирует об открытии модального окна, используется для блокировки прокрутки страницы

#### `modal:close`

- **Источник:** `Modal`
- **Когда генерируется:** При закрытии модального окна (клик по крестику, клик по overlay, нажатие Escape)
- **Данные:** Отсутствуют
- **Описание:** Сигнализирует о закрытии модального окна, используется для разблокировки прокрутки страницы

### События карточек товара

#### `card:select`

- **Источник:** `CatalogCard`
- **Когда генерируется:** При клике на карточку товара в каталоге
- **Данные:** `{ id: string }` - ID выбранного товара
- **Описание:** Сигнализирует о выборе товара для отображения в модальном окне предпросмотра

#### `card:add`

- **Источник:** `PreviewCard`
- **Когда генерируется:** При клике на кнопку "В корзину" в модальном окне предпросмотра
- **Данные:** `{ id: string }` - ID товара
- **Описание:** Сигнализирует о добавлении товара в корзину

#### `card:remove`

- **Источник:** `BasketCard`
- **Когда генерируется:** При клике на кнопку удаления товара из корзины
- **Данные:** `{ id: string }` - ID товара для удаления
- **Описание:** Сигнализирует об удалении товара из корзины

### События корзины

#### `order:start`

- **Источник:** `Basket`
- **Когда генерируется:** При клике на кнопку "Оформить" в корзине
- **Данные:** Отсутствуют
- **Описание:** Сигнализирует о начале процесса оформления заказа (переход к форме заказа)

### События форм

#### `input:change`

- **Источник:** `Form` (базовый класс для всех форм)
- **Когда генерируется:** При изменении значения любого поля формы
- **Данные:** `{ field: string, value: string }` - название поля и новое значение
- **Описание:** Сигнализирует об изменении данных в форме, используется для валидации

#### `form:submit`

- **Источник:** `Form` (базовый класс для всех форм)
- **Когда генерируется:** При отправке формы (клик на кнопку submit)
- **Данные:** Отсутствуют
- **Описание:** Сигнализирует о попытке отправки формы

### События успешного заказа

#### `success:close`

- **Источник:** `Success`
- **Когда генерируется:** При клике на кнопку "За новыми покупками!" после успешного заказа
- **Данные:** Отсутствуют
- **Описание:** Сигнализирует о закрытии окна успешного заказа и возврате к каталогу

---

## Презентер (Presenter)

### Концепция реализации

В проекте используется подход с реализацией Презентера непосредственно в основном файле приложения `main.ts`. Этот подход был выбран по следующим причинам:

1. **Простота** - приложение имеет одну страницу и не требует сложной иерархии презентеров
2. **Прозрачность** - вся бизнес-логика находится в одном месте и легко читается
3. **Производительность** - не создается дополнительный уровень абстракции
4. **Соответствие паттерну MVP** - презентер остается независимым слоем, связывающим модели и представления через события

### Архитектура Презентера

Презентер в приложении реализован через систему обработки событий (Event Handlers). Он выполняет следующие функции:

1. **Связывание компонентов** - соединяет модели данных с представлениями
2. **Обработка событий** - реагирует на события от моделей и представлений
3. **Управление потоком данных** - координирует передачу данных между слоями
4. **Реализация бизнес-логики** - определяет поведение приложения

### Ключевые принципы

#### Презентер не генерирует события

Презентер только **обрабатывает** события, но не генерирует их. Все события генерируются либо в моделях данных (при изменении данных), либо в представлениях (при действиях пользователя).

#### Перерисовка представлений

Представления перерисовываются только в двух случаях:

1. При обработке события от модели данных об изменении данных
2. При открытии модального окна с новым контентом

#### Односторонний поток данных

Данные всегда передаются в одном направлении:

- Модель → Презентер → Представление (для отображения)
- Представление → Презентер → Модель (для сохранения)

### Структура обработчиков событий

#### 1. События моделей данных

**`catalog:changed`** - Обновление каталога товаров

- Получает массив товаров из модели Products
- Создает карточку для каждого товара (CatalogCard)
- Отображает галерею на главной странице

**`preview:changed`** - Изменение выбранного товара

- Получает данные выбранного товара
- Создает карточку предпросмотра (PreviewCard)
- Открывает модальное окно с деталями товара

**`basket:changed`** - Изменение содержимого корзины

- Обновляет счетчик товаров в шапке
- Перерисовывает список товаров в корзине
- Пересчитывает общую стоимость

**`buyer:changed`** - Изменение данных покупателя

- Запускает валидацию всех полей
- Обновляет состояние кнопок submit в формах
- Отображает ошибки валидации

#### 2. События представлений

**`card:select`** - Выбор карточки товара

- Находит товар в модели Products
- Устанавливает товар для предпросмотра через setPreview()

**`card:add`** - Добавление товара в корзину

- Находит товар в модели Products
- Добавляет товар в корзину через addItem()
- Закрывает модальное окно

**`card:remove`** - Удаление товара из корзины

- Находит товар в модели Products
- Удаляет товар из корзины через removeItem()

**`basket:open`** - Открытие корзины

- Рендерит представление корзины
- Открывает модальное окно с корзиной

**`order:start`** - Начало оформления заказа

- Очищает данные покупателя (если необходимо)
- Открывает форму заказа (OrderForm)

**`form:submit`** - Отправка формы

- Обрабатывается по-разному в зависимости от контекста:
  - Для OrderForm: переход к форме контактов
  - Для ContactsForm: отправка заказа на сервер

**`input:change`** - Изменение поля ввода

- Сохраняет данные в модель Buyer
- Запускает валидацию
- Обновляет состояние форм

**`modal:open` / `modal:close`** - Управление модальным окном

- Блокирует/разблокирует прокрутку страницы

**`success:close`** - Закрытие окна успешного заказа

- Закрывает модальное окно
- Возвращает к главной странице

### Расположение кода

Код Презентера находится в файле `src/main.ts`
